<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Hardening Guide - Neo Service Layer</title>
    <meta name="description" content="Enterprise security hardening guide for Neo Service Layer with Intel SGX implementation, zero-trust architecture, compliance frameworks, and advanced threat protection strategies.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docs.neoservicelayer.com/security-hardening">
    <meta property="og:title" content="Neo Service Layer Security Hardening Guide">
    <meta property="og:description" content="Complete security hardening guide with Intel SGX and enterprise security best practices">
    <meta property="og:image" content="https://docs.neoservicelayer.com/images/security-guide-og.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docs.neoservicelayer.com/security-hardening">
    <meta property="twitter:title" content="Neo Service Layer Security Hardening Guide">
    <meta property="twitter:description" content="Complete security hardening guide with Intel SGX implementation">
    <meta property="twitter:image" content="https://docs.neoservicelayer.com/images/security-guide-twitter.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://docs.neoservicelayer.com/security-hardening">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../public/favicon.svg">
    <link rel="icon" type="image/png" href="../public/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../public/favicon-16x16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="../public/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../src/styles/design-system.css">
    <link rel="stylesheet" href="../src/styles/docs-professional.css">
    <link rel="stylesheet" href="../src/styles/code-playground.css">
    <link rel="stylesheet" href="../src/styles/docs-search.css">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@2.40.0/tabler-icons.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-one-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <!-- Security Guide Specific Styles -->
    <style>
        .security-architecture {
            background: var(--docs-bg-secondary);
            border: 1px solid var(--docs-border-light);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        
        .security-layer {
            background: var(--docs-bg-primary);
            border: 1px solid var(--docs-border-light);
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .layer-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .layer-icon {
            width: 48px;
            height: 48px;
            background: var(--docs-accent-blue);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .layer-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--docs-text-primary);
            margin: 0;
        }
        
        .layer-badge {
            margin-left: auto;
            padding: 6px 12px;
            background: var(--docs-bg-tertiary);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--docs-accent-blue);
        }
        
        .threat-model {
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        
        .threat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .threat-icon {
            color: #ef4444;
            font-size: 24px;
        }
        
        .threat-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--docs-text-primary);
            margin: 0;
        }
        
        .security-control {
            background: var(--docs-bg-secondary);
            border: 1px solid var(--docs-border-light);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }
        
        .control-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .control-icon {
            width: 40px;
            height: 40px;
            background: var(--docs-accent-green);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .control-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--docs-text-primary);
            margin: 0;
        }
        
        .control-effectiveness {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .effectiveness-bar {
            width: 100px;
            height: 8px;
            background: var(--docs-bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .effectiveness-fill {
            height: 100%;
            background: var(--docs-accent-green);
            transition: width 0.3s ease;
        }
        
        .sgx-implementation {
            background: var(--docs-bg-secondary);
            border: 2px solid var(--docs-accent-blue);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        
        .sgx-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .sgx-icon {
            width: 48px;
            height: 48px;
            background: var(--docs-accent-blue);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .compliance-matrix {
            background: var(--docs-bg-primary);
            border: 1px solid var(--docs-border-light);
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .compliance-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .compliance-table th {
            background: var(--docs-bg-tertiary);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid var(--docs-border-light);
        }
        
        .compliance-table td {
            padding: 12px;
            border-bottom: 1px solid var(--docs-border-light);
        }
        
        .compliance-table tr:last-child td {
            border-bottom: none;
        }
        
        .compliance-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-compliant {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }
        
        .status-partial {
            background: rgba(251, 191, 36, 0.1);
            color: #f59e0b;
        }
        
        .status-planned {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .security-checklist {
            background: var(--docs-bg-secondary);
            border: 1px solid var(--docs-border-light);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        
        .checklist-category {
            margin: 20px 0;
        }
        
        .checklist-category-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--docs-text-primary);
            margin: 0 0 12px 0;
        }
        
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 8px 0;
        }
        
        .checklist-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--docs-border-medium);
            border-radius: 4px;
            flex-shrink: 0;
            margin-top: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .checklist-checkbox.checked {
            background: var(--docs-accent-green);
            border-color: var(--docs-accent-green);
        }
        
        .checklist-checkbox.checked::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }
        
        .checklist-content {
            flex: 1;
            color: var(--docs-text-secondary);
        }
        
        .audit-log-example {
            background: #000;
            color: #0f0;
            font-family: 'JetBrains Mono', monospace;
            padding: 20px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 16px 0;
        }
        
        .security-metric {
            background: var(--docs-bg-primary);
            border: 1px solid var(--docs-border-light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--docs-accent-blue);
            margin: 0;
        }
        
        .metric-label {
            font-size: 14px;
            color: var(--docs-text-secondary);
            margin: 8px 0 0 0;
        }
        
        .incident-response {
            background: rgba(251, 191, 36, 0.05);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        
        .response-phase {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--docs-bg-primary);
            border-radius: 8px;
            margin: 12px 0;
        }
        
        .phase-number {
            width: 32px;
            height: 32px;
            background: #f59e0b;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .phase-content {
            flex: 1;
        }
        
        .phase-title {
            font-weight: 600;
            color: var(--docs-text-primary);
            margin: 0 0 4px 0;
        }
        
        .phase-duration {
            font-size: 12px;
            color: var(--docs-text-secondary);
        }
    </style>
</head>
<body class="security-guide-page">
    <!-- Documentation Header -->
    <header class="docs-header-nav security-header">
        <div class="docs-header-container">
            <div class="docs-header-left">
                <a href="/" class="docs-brand">
                    <div class="docs-brand-icon">🔒</div>
                    <div class="docs-brand-text">
                        <div class="docs-brand-name">Neo Service Layer</div>
                        <div class="docs-brand-subtitle">Security Hardening Guide</div>
                    </div>
                </a>
                
                <div class="security-stats">
                    <div class="stat-item">
                        <span class="stat-value">Intel SGX</span>
                        <span class="stat-label">Hardware Security</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">Zero Trust</span>
                        <span class="stat-label">Architecture</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">SOC 2</span>
                        <span class="stat-label">Compliant</span>
                    </div>
                </div>
            </div>
            
            <div class="docs-header-center">
                <div class="docs-search-container">
                    <div class="docs-search-input-wrapper">
                        <i class="ti ti-search docs-search-icon"></i>
                        <input 
                            type="text" 
                            placeholder="Search security controls..." 
                            class="docs-search-input"
                            id="docs-search"
                        >
                        <div class="docs-search-shortcut">
                            <kbd>⌘</kbd><kbd>K</kbd>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="docs-header-right">
                <button class="docs-theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <i class="ti ti-sun docs-theme-icon-light"></i>
                    <i class="ti ti-moon docs-theme-icon-dark"></i>
                </button>
                
                <a href="https://github.com/neo-service-layer" class="docs-github-link" target="_blank" rel="noopener">
                    <i class="ti ti-brand-github"></i>
                </a>
                
                <a href="/app.html" class="docs-cta-button">
                    Try Live Demo
                    <i class="ti ti-external-link"></i>
                </a>
                
                <button class="docs-mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
                    <i class="ti ti-menu-2"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Documentation Container -->
    <div class="docs-container">
        <!-- Sidebar Navigation -->
        <nav class="docs-sidebar" id="docs-sidebar">
            <div class="docs-sidebar-header">
                <h3 class="docs-sidebar-title">Security Guide</h3>
                <div class="docs-sidebar-version">
                    <span class="version-badge">v1.5.2</span>
                    <span>Enterprise</span>
                </div>
            </div>
            
            <div class="docs-nav">
                <!-- Overview -->
                <div class="docs-nav-section">
                    <h4 class="docs-nav-section-title">Overview</h4>
                    <ul class="docs-nav-list">
                        <li class="docs-nav-item">
                            <a href="#introduction" class="docs-nav-link active">
                                <i class="ti ti-info-circle"></i>
                                Introduction
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#architecture" class="docs-nav-link">
                                <i class="ti ti-building-arch"></i>
                                Security Architecture
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#threat-model" class="docs-nav-link">
                                <i class="ti ti-alert-triangle"></i>
                                Threat Model
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#compliance" class="docs-nav-link">
                                <i class="ti ti-certificate"></i>
                                Compliance
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Intel SGX -->
                <div class="docs-nav-section">
                    <h4 class="docs-nav-section-title">Intel SGX</h4>
                    <ul class="docs-nav-list">
                        <li class="docs-nav-item">
                            <a href="#sgx-overview" class="docs-nav-link">
                                <i class="ti ti-cpu"></i>
                                SGX Overview
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#sgx-implementation" class="docs-nav-link">
                                <i class="ti ti-code"></i>
                                Implementation
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#enclave-design" class="docs-nav-link">
                                <i class="ti ti-box"></i>
                                Enclave Design
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#attestation" class="docs-nav-link">
                                <i class="ti ti-shield-check"></i>
                                Remote Attestation
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Security Controls -->
                <div class="docs-nav-section">
                    <h4 class="docs-nav-section-title">Security Controls</h4>
                    <ul class="docs-nav-list">
                        <li class="docs-nav-item">
                            <a href="#authentication" class="docs-nav-link">
                                <i class="ti ti-key"></i>
                                Authentication
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#authorization" class="docs-nav-link">
                                <i class="ti ti-user-check"></i>
                                Authorization
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#encryption" class="docs-nav-link">
                                <i class="ti ti-lock"></i>
                                Encryption
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#network-security" class="docs-nav-link">
                                <i class="ti ti-network"></i>
                                Network Security
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#secrets-management" class="docs-nav-link">
                                <i class="ti ti-key"></i>
                                Secrets Management
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#audit-logging" class="docs-nav-link">
                                <i class="ti ti-file-text"></i>
                                Audit Logging
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Operations -->
                <div class="docs-nav-section">
                    <h4 class="docs-nav-section-title">Security Operations</h4>
                    <ul class="docs-nav-list">
                        <li class="docs-nav-item">
                            <a href="#monitoring" class="docs-nav-link">
                                <i class="ti ti-activity"></i>
                                Security Monitoring
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#incident-response" class="docs-nav-link">
                                <i class="ti ti-urgent"></i>
                                Incident Response
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#vulnerability-management" class="docs-nav-link">
                                <i class="ti ti-bug"></i>
                                Vulnerability Management
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#security-testing" class="docs-nav-link">
                                <i class="ti ti-test-pipe"></i>
                                Security Testing
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Best Practices -->
                <div class="docs-nav-section">
                    <h4 class="docs-nav-section-title">Best Practices</h4>
                    <ul class="docs-nav-list">
                        <li class="docs-nav-item">
                            <a href="#hardening-checklist" class="docs-nav-link">
                                <i class="ti ti-checklist"></i>
                                Hardening Checklist
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#secure-development" class="docs-nav-link">
                                <i class="ti ti-code-plus"></i>
                                Secure Development
                            </a>
                        </li>
                        <li class="docs-nav-item">
                            <a href="#security-training" class="docs-nav-link">
                                <i class="ti ti-school"></i>
                                Security Training
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="docs-main">
            <!-- Introduction Section -->
            <section id="introduction" class="docs-section">
                <div class="section-header">
                    <h1 class="section-title">Security Hardening Guide</h1>
                    <div class="section-meta">
                        <span class="section-badge">Enterprise Security</span>
                        <span class="section-version">v1.5.2</span>
                        <span class="section-update">Updated Jan 30, 2025</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="section-intro">
                        <p class="lead">
                            Comprehensive security hardening guide for Neo Service Layer with Intel SGX hardware security, 
                            zero-trust architecture, enterprise compliance frameworks, and advanced threat protection strategies 
                            designed for production blockchain environments.
                        </p>
                    </div>

                    <!-- Security Overview -->
                    <div class="security-overview">
                        <h3>Security-First Design Principles</h3>
                        <div class="principles-grid">
                            <div class="principle-card">
                                <div class="principle-icon">
                                    <i class="ti ti-cpu-2"></i>
                                </div>
                                <h4>Hardware-Based Security</h4>
                                <p>Intel SGX enclaves provide hardware-level isolation for cryptographic operations and sensitive data</p>
                            </div>
                            
                            <div class="principle-card">
                                <div class="principle-icon">
                                    <i class="ti ti-shield-lock"></i>
                                </div>
                                <h4>Zero Trust Architecture</h4>
                                <p>No implicit trust between services, continuous verification, and least privilege access</p>
                            </div>
                            
                            <div class="principle-card">
                                <div class="principle-icon">
                                    <i class="ti ti-layers-intersect"></i>
                                </div>
                                <h4>Defense in Depth</h4>
                                <p>Multiple layers of security controls to protect against various attack vectors</p>
                            </div>
                            
                            <div class="principle-card">
                                <div class="principle-icon">
                                    <i class="ti ti-certificate"></i>
                                </div>
                                <h4>Compliance Ready</h4>
                                <p>Built to meet SOC 2, GDPR, HIPAA, and financial services regulatory requirements</p>
                            </div>
                        </div>
                    </div>

                    <!-- Security Metrics -->
                    <div class="security-metrics">
                        <h3>Current Security Posture</h3>
                        <div class="metrics-grid">
                            <div class="security-metric">
                                <div class="metric-value">0</div>
                                <p class="metric-label">Security Incidents (30d)</p>
                            </div>
                            <div class="security-metric">
                                <div class="metric-value">256-bit</div>
                                <p class="metric-label">Encryption Strength</p>
                            </div>
                            <div class="security-metric">
                                <div class="metric-value">100%</div>
                                <p class="metric-label">Patch Compliance</p>
                            </div>
                            <div class="security-metric">
                                <div class="metric-value">A+</div>
                                <p class="metric-label">SSL Labs Rating</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Security Architecture Section -->
            <section id="architecture" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Security Architecture</h2>
                    <div class="section-meta">
                        <span class="section-badge">Multi-Layer Defense</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="security-architecture">
                        <h3>Layered Security Model</h3>
                        <p>Neo Service Layer implements a comprehensive multi-layer security architecture:</p>
                        
                        <!-- Layer 1: Hardware Security -->
                        <div class="security-layer">
                            <div class="layer-header">
                                <div class="layer-icon">
                                    <i class="ti ti-cpu"></i>
                                </div>
                                <h4 class="layer-title">Layer 1: Hardware Security</h4>
                                <span class="layer-badge">Intel SGX</span>
                            </div>
                            
                            <div class="layer-content">
                                <p>Hardware-based security using Intel Software Guard Extensions (SGX):</p>
                                <ul>
                                    <li><strong>Secure Enclaves:</strong> Isolated execution environments for sensitive operations</li>
                                    <li><strong>Memory Encryption:</strong> Hardware-level encryption of enclave memory</li>
                                    <li><strong>Remote Attestation:</strong> Cryptographic proof of enclave integrity</li>
                                    <li><strong>Sealed Storage:</strong> Persistent encrypted storage bound to specific hardware</li>
                                </ul>
                                
                                <div class="code-playground">
                                    <code class="language-cpp">
// SGX Enclave Implementation
#include "sgx_urts.h"
#include "sgx_tcrypto.h"
#include "Enclave_u.h"

// Initialize SGX enclave
sgx_status_t initialize_enclave(sgx_enclave_id_t* eid) {
    sgx_launch_token_t token = {0};
    sgx_status_t ret = SGX_ERROR_UNEXPECTED;
    int updated = 0;
    
    // Create enclave
    ret = sgx_create_enclave(
        ENCLAVE_FILENAME,
        SGX_DEBUG_FLAG,
        &token,
        &updated,
        eid,
        NULL
    );
    
    if (ret != SGX_SUCCESS) {
        return ret;
    }
    
    // Initialize crypto context inside enclave
    ret = ecall_init_crypto(*eid);
    
    return ret;
}

// Secure key generation inside enclave
sgx_status_t generate_secure_key(
    sgx_enclave_id_t eid,
    uint8_t* sealed_key,
    size_t sealed_key_len
) {
    sgx_status_t ret = SGX_ERROR_UNEXPECTED;
    
    // Generate key inside enclave
    ret = ecall_generate_key(
        eid,
        sealed_key,
        sealed_key_len
    );
    
    return ret;
}
                                    </code>
                                </div>
                            </div>
                        </div>

                        <!-- Layer 2: Network Security -->
                        <div class="security-layer">
                            <div class="layer-header">
                                <div class="layer-icon">
                                    <i class="ti ti-network"></i>
                                </div>
                                <h4 class="layer-title">Layer 2: Network Security</h4>
                                <span class="layer-badge">Zero Trust</span>
                            </div>
                            
                            <div class="layer-content">
                                <p>Comprehensive network security controls:</p>
                                <ul>
                                    <li><strong>mTLS:</strong> Mutual TLS for all service-to-service communication</li>
                                    <li><strong>Network Policies:</strong> Kubernetes NetworkPolicy for micro-segmentation</li>
                                    <li><strong>Web Application Firewall:</strong> ModSecurity with OWASP Core Rule Set</li>
                                    <li><strong>DDoS Protection:</strong> Rate limiting and traffic filtering</li>
                                </ul>
                                
                                <div class="code-playground">
                                    <code class="language-yaml">
# Network Security Policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: storage-service-policy
  namespace: neo-prod
spec:
  podSelector:
    matchLabels:
      app: storage-service
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
  # Only allow traffic from API gateway
  - from:
    - namespaceSelector:
        matchLabels:
          name: neo-prod
      podSelector:
        matchLabels:
          app: api-gateway
    ports:
    - protocol: TCP
      port: 8080
      
  # Allow Prometheus metrics scraping
  - from:
    - namespaceSelector:
        matchLabels:
          name: neo-monitoring
      podSelector:
        matchLabels:
          app: prometheus
    ports:
    - protocol: TCP
      port: 9090
      
  egress:
  # Allow DNS
  - to:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53
      
  # Allow database access
  - to:
    - namespaceSelector:
        matchLabels:
          name: neo-database
    ports:
    - protocol: TCP
      port: 5432
                                    </code>
                                </div>
                            </div>
                        </div>

                        <!-- Layer 3: Application Security -->
                        <div class="security-layer">
                            <div class="layer-header">
                                <div class="layer-icon">
                                    <i class="ti ti-apps"></i>
                                </div>
                                <h4 class="layer-title">Layer 3: Application Security</h4>
                                <span class="layer-badge">Secure by Design</span>
                            </div>
                            
                            <div class="layer-content">
                                <p>Application-level security controls:</p>
                                <ul>
                                    <li><strong>Input Validation:</strong> Strict input validation and sanitization</li>
                                    <li><strong>Output Encoding:</strong> Context-aware output encoding</li>
                                    <li><strong>Session Management:</strong> Secure session handling with rotation</li>
                                    <li><strong>CSRF Protection:</strong> Double-submit cookie pattern</li>
                                    <li><strong>Security Headers:</strong> Comprehensive security headers</li>
                                </ul>
                                
                                <div class="code-playground">
                                    <code class="language-go">
// Security middleware implementation
package security

import (
    "crypto/rand"
    "encoding/base64"
    "net/http"
    "time"
)

// SecurityHeaders middleware adds security headers
func SecurityHeaders(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // Security headers
        w.Header().Set("X-Content-Type-Options", "nosniff")
        w.Header().Set("X-Frame-Options", "DENY")
        w.Header().Set("X-XSS-Protection", "1; mode=block")
        w.Header().Set("Strict-Transport-Security", "max-age=63072000; includeSubDomains; preload")
        w.Header().Set("Content-Security-Policy", "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'")
        w.Header().Set("Referrer-Policy", "strict-origin-when-cross-origin")
        w.Header().Set("Permissions-Policy", "geolocation=(), microphone=(), camera=()")
        
        // Add request ID for tracing
        requestID := r.Header.Get("X-Request-ID")
        if requestID == "" {
            requestID = generateRequestID()
        }
        w.Header().Set("X-Request-ID", requestID)
        
        next.ServeHTTP(w, r)
    })
}

// CSRF protection
type CSRFProtection struct {
    tokenLength int
    cookieName  string
    headerName  string
}

func (c *CSRFProtection) Middleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // Skip CSRF for safe methods
        if r.Method == "GET" || r.Method == "HEAD" || r.Method == "OPTIONS" {
            next.ServeHTTP(w, r)
            return
        }
        
        // Verify CSRF token
        cookie, err := r.Cookie(c.cookieName)
        if err != nil {
            http.Error(w, "CSRF cookie missing", http.StatusForbidden)
            return
        }
        
        headerToken := r.Header.Get(c.headerName)
        if !secureCompare(cookie.Value, headerToken) {
            http.Error(w, "CSRF token mismatch", http.StatusForbidden)
            return
        }
        
        next.ServeHTTP(w, r)
    })
}

// Input validation
func ValidateInput(input string, pattern string) error {
    // Implement strict input validation
    validator := regexp.MustCompile(pattern)
    if !validator.MatchString(input) {
        return ErrInvalidInput
    }
    
    // Check for common injection patterns
    if containsSQLInjection(input) || containsXSS(input) {
        return ErrMaliciousInput
    }
    
    return nil
}

// Rate limiting with token bucket
type RateLimiter struct {
    rate     int
    capacity int
    mu       sync.Mutex
    buckets  map[string]*TokenBucket
}

func (rl *RateLimiter) Middleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        key := getClientKey(r)
        
        rl.mu.Lock()
        bucket, exists := rl.buckets[key]
        if !exists {
            bucket = NewTokenBucket(rl.rate, rl.capacity)
            rl.buckets[key] = bucket
        }
        rl.mu.Unlock()
        
        if !bucket.Allow() {
            http.Error(w, "Rate limit exceeded", http.StatusTooManyRequests)
            return
        }
        
        next.ServeHTTP(w, r)
    })
}
                                    </code>
                                </div>
                            </div>
                        </div>

                        <!-- Layer 4: Data Security -->
                        <div class="security-layer">
                            <div class="layer-header">
                                <div class="layer-icon">
                                    <i class="ti ti-database-lock"></i>
                                </div>
                                <h4 class="layer-title">Layer 4: Data Security</h4>
                                <span class="layer-badge">Encryption at Rest</span>
                            </div>
                            
                            <div class="layer-content">
                                <p>Comprehensive data protection:</p>
                                <ul>
                                    <li><strong>Encryption at Rest:</strong> AES-256-GCM for all stored data</li>
                                    <li><strong>Encryption in Transit:</strong> TLS 1.3 for all communications</li>
                                    <li><strong>Key Management:</strong> Hardware Security Module (HSM) integration</li>
                                    <li><strong>Data Classification:</strong> Automated data sensitivity classification</li>
                                    <li><strong>Data Loss Prevention:</strong> DLP policies and monitoring</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Threat Model Section -->
            <section id="threat-model" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Threat Model</h2>
                    <div class="section-meta">
                        <span class="section-badge">Risk Analysis</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="threat-model">
                        <div class="threat-header">
                            <i class="ti ti-alert-triangle threat-icon"></i>
                            <h3 class="threat-title">Identified Threats and Mitigations</h3>
                        </div>
                        
                        <div class="threat-analysis">
                            <h4>STRIDE Threat Analysis</h4>
                            
                            <div class="threat-category">
                                <h5>Spoofing Identity</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> Attacker impersonates legitimate user or service
                                        <br><strong>Mitigation:</strong> Multi-factor authentication, mutual TLS, API key rotation
                                    </div>
                                </div>
                            </div>
                            
                            <div class="threat-category">
                                <h5>Tampering with Data</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> Modification of data in transit or at rest
                                        <br><strong>Mitigation:</strong> Cryptographic signatures, integrity checks, immutable audit logs
                                    </div>
                                </div>
                            </div>
                            
                            <div class="threat-category">
                                <h5>Repudiation</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> User denies performing an action
                                        <br><strong>Mitigation:</strong> Comprehensive audit logging, blockchain-based proof
                                    </div>
                                </div>
                            </div>
                            
                            <div class="threat-category">
                                <h5>Information Disclosure</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> Unauthorized access to sensitive data
                                        <br><strong>Mitigation:</strong> Encryption, access controls, SGX enclaves, data masking
                                    </div>
                                </div>
                            </div>
                            
                            <div class="threat-category">
                                <h5>Denial of Service</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> Service availability attacks
                                        <br><strong>Mitigation:</strong> Rate limiting, DDoS protection, auto-scaling
                                    </div>
                                </div>
                            </div>
                            
                            <div class="threat-category">
                                <h5>Elevation of Privilege</h5>
                                <div class="threat-items">
                                    <div class="threat-item">
                                        <strong>Threat:</strong> Unauthorized privilege escalation
                                        <br><strong>Mitigation:</strong> Principle of least privilege, RBAC, regular permission audits
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Intel SGX Implementation -->
            <section id="sgx-implementation" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Intel SGX Implementation</h2>
                    <div class="section-meta">
                        <span class="section-badge">Hardware Security</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="sgx-implementation">
                        <div class="sgx-header">
                            <div class="sgx-icon">SGX</div>
                            <h3>Secure Enclave Architecture</h3>
                        </div>
                        
                        <p>Intel SGX provides hardware-based security for the most sensitive operations:</p>
                        
                        <!-- Enclave Design -->
                        <div class="code-playground">
                            <code class="language-cpp">
// Enclave Definition (Enclave.edl)
enclave {
    from "sgx_tstdc.edl" import *;
    from "sgx_tcrypto.edl" import *;
    
    trusted {
        /* Crypto operations inside enclave */
        public sgx_status_t ecall_generate_keypair(
            [out, size=pubkey_size] uint8_t* pubkey,
            size_t pubkey_size,
            [out, size=sealed_size] uint8_t* sealed_privkey,
            size_t sealed_size
        );
        
        public sgx_status_t ecall_sign_transaction(
            [in, size=tx_size] const uint8_t* transaction,
            size_t tx_size,
            [in, size=sealed_size] const uint8_t* sealed_privkey,
            size_t sealed_size,
            [out, size=sig_size] uint8_t* signature,
            size_t sig_size
        );
        
        public sgx_status_t ecall_decrypt_data(
            [in, size=encrypted_size] const uint8_t* encrypted_data,
            size_t encrypted_size,
            [in, size=key_size] const uint8_t* sealed_key,
            size_t key_size,
            [out, size=decrypted_size] uint8_t* decrypted_data,
            size_t decrypted_size
        );
    };
    
    untrusted {
        void ocall_print_string([in, string] const char *str);
    };
};

// Enclave Implementation
#include "Enclave_t.h"
#include "sgx_trts.h"
#include "sgx_tcrypto.h"
#include "sgx_tseal.h"

// Generate secure keypair inside enclave
sgx_status_t ecall_generate_keypair(
    uint8_t* pubkey,
    size_t pubkey_size,
    uint8_t* sealed_privkey,
    size_t sealed_size
) {
    sgx_status_t ret = SGX_ERROR_UNEXPECTED;
    sgx_ecc_state_handle_t ecc_handle = NULL;
    sgx_ec256_private_t private_key;
    sgx_ec256_public_t public_key;
    
    // Open ECC context
    ret = sgx_ecc256_open_context(&ecc_handle);
    if (ret != SGX_SUCCESS) {
        return ret;
    }
    
    // Generate keypair
    ret = sgx_ecc256_create_key_pair(
        &private_key,
        &public_key,
        ecc_handle
    );
    
    if (ret != SGX_SUCCESS) {
        sgx_ecc256_close_context(ecc_handle);
        return ret;
    }
    
    // Copy public key
    if (pubkey_size >= sizeof(sgx_ec256_public_t)) {
        memcpy(pubkey, &public_key, sizeof(sgx_ec256_public_t));
    }
    
    // Seal private key
    uint32_t sealed_data_size = sgx_calc_sealed_data_size(
        0,
        sizeof(sgx_ec256_private_t)
    );
    
    if (sealed_size >= sealed_data_size) {
        ret = sgx_seal_data(
            0,
            NULL,
            sizeof(sgx_ec256_private_t),
            (uint8_t*)&private_key,
            sealed_data_size,
            (sgx_sealed_data_t*)sealed_privkey
        );
    }
    
    // Clean up
    memset(&private_key, 0, sizeof(private_key));
    sgx_ecc256_close_context(ecc_handle);
    
    return ret;
}

// Sign transaction inside enclave
sgx_status_t ecall_sign_transaction(
    const uint8_t* transaction,
    size_t tx_size,
    const uint8_t* sealed_privkey,
    size_t sealed_size,
    uint8_t* signature,
    size_t sig_size
) {
    sgx_status_t ret = SGX_ERROR_UNEXPECTED;
    sgx_ecc_state_handle_t ecc_handle = NULL;
    sgx_ec256_private_t private_key;
    sgx_ec256_signature_t ecc_signature;
    uint32_t unsealed_size = sizeof(sgx_ec256_private_t);
    
    // Unseal private key
    ret = sgx_unseal_data(
        (const sgx_sealed_data_t*)sealed_privkey,
        NULL,
        NULL,
        (uint8_t*)&private_key,
        &unsealed_size
    );
    
    if (ret != SGX_SUCCESS) {
        return ret;
    }
    
    // Open ECC context
    ret = sgx_ecc256_open_context(&ecc_handle);
    if (ret != SGX_SUCCESS) {
        memset(&private_key, 0, sizeof(private_key));
        return ret;
    }
    
    // Sign transaction
    ret = sgx_ecdsa_sign(
        transaction,
        tx_size,
        &private_key,
        &ecc_signature,
        ecc_handle
    );
    
    // Copy signature
    if (ret == SGX_SUCCESS && sig_size >= sizeof(sgx_ec256_signature_t)) {
        memcpy(signature, &ecc_signature, sizeof(sgx_ec256_signature_t));
    }
    
    // Clean up
    memset(&private_key, 0, sizeof(private_key));
    sgx_ecc256_close_context(ecc_handle);
    
    return ret;
}
                            </code>
                        </div>

                        <!-- Remote Attestation -->
                        <h4>Remote Attestation</h4>
                        <p>Cryptographic proof of enclave integrity:</p>
                        
                        <div class="code-playground">
                            <code class="language-go">
// Remote attestation implementation
package sgx

import (
    "crypto/x509"
    "encoding/base64"
    "fmt"
)

type AttestationService struct {
    iasURL string
    apiKey string
}

// VerifyQuote verifies SGX quote with Intel Attestation Service
func (as *AttestationService) VerifyQuote(quote []byte) (*AttestationReport, error) {
    // Encode quote for IAS
    encodedQuote := base64.StdEncoding.EncodeToString(quote)
    
    // Prepare attestation request
    request := AttestationRequest{
        ISVEnclaveQuote: encodedQuote,
    }
    
    // Send to Intel Attestation Service
    resp, err := as.sendToIAS(request)
    if err != nil {
        return nil, fmt.Errorf("IAS request failed: %w", err)
    }
    
    // Verify IAS response signature
    if err := as.verifyIASSignature(resp); err != nil {
        return nil, fmt.Errorf("IAS signature verification failed: %w", err)
    }
    
    // Parse attestation report
    report, err := as.parseAttestationReport(resp.Body)
    if err != nil {
        return nil, fmt.Errorf("failed to parse report: %w", err)
    }
    
    // Verify enclave measurements
    if err := as.verifyMeasurements(report); err != nil {
        return nil, fmt.Errorf("measurement verification failed: %w", err)
    }
    
    return report, nil
}

// VerifyMeasurements checks enclave measurements
func (as *AttestationService) verifyMeasurements(report *AttestationReport) error {
    // Expected enclave measurements
    expectedMREnclave := "a3f3c2d1e5b4a6c8d7f9e8b7a6c5d4e3f2a1b0c9d8e7f6a5b4c3d2e1f0a9b8c7"
    expectedMRSigner := "b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b0c9d8e7f6a5b4c3"
    
    if report.MREnclave != expectedMREnclave {
        return fmt.Errorf("invalid MRENCLAVE: got %s, expected %s", 
            report.MREnclave, expectedMREnclave)
    }
    
    if report.MRSigner != expectedMRSigner {
        return fmt.Errorf("invalid MRSIGNER: got %s, expected %s", 
            report.MRSigner, expectedMRSigner)
    }
    
    // Verify enclave attributes
    if !report.Attributes.Initialized || !report.Attributes.Debug {
        return fmt.Errorf("invalid enclave attributes")
    }
    
    return nil
}

// EstablishSecureChannel creates secure channel with attested enclave
func EstablishSecureChannel(enclaveID string) (*SecureChannel, error) {
    // Get enclave quote
    quote, err := getEnclaveQuote(enclaveID)
    if err != nil {
        return nil, err
    }
    
    // Verify attestation
    attestation := &AttestationService{
        iasURL: "https://api.trustedservices.intel.com/sgx/attestation/v4/",
        apiKey: getIASAPIKey(),
    }
    
    report, err := attestation.VerifyQuote(quote)
    if err != nil {
        return nil, err
    }
    
    // Extract enclave public key from report
    enclavePubKey, err := extractPublicKey(report.UserData)
    if err != nil {
        return nil, err
    }
    
    // Establish secure channel using enclave's public key
    channel := &SecureChannel{
        EnclaveID:     enclaveID,
        EnclavePubKey: enclavePubKey,
        SessionKey:    generateSessionKey(),
    }
    
    return channel, nil
}
                            </code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Authentication & Authorization -->
            <section id="authentication" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Authentication & Authorization</h2>
                    <div class="section-meta">
                        <span class="section-badge">Identity Management</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="security-control">
                        <div class="control-header">
                            <div class="control-icon">
                                <i class="ti ti-key"></i>
                            </div>
                            <h3 class="control-title">Multi-Factor Authentication</h3>
                            <div class="control-effectiveness">
                                <div class="effectiveness-bar">
                                    <div class="effectiveness-fill" style="width: 95%"></div>
                                </div>
                                <span>95% Effective</span>
                            </div>
                        </div>
                        
                        <p>Comprehensive authentication implementation:</p>
                        
                        <div class="code-playground">
                            <code class="language-go">
// Multi-factor authentication implementation
package auth

import (
    "crypto/rand"
    "encoding/base32"
    "fmt"
    "time"
    
    "github.com/pquerna/otp/totp"
)

type MFAService struct {
    issuer string
    redis  *redis.Client
}

// EnrollMFA enrolls user in MFA
func (m *MFAService) EnrollMFA(userID string) (*MFAEnrollment, error) {
    // Generate secret
    secret := make([]byte, 20)
    _, err := rand.Read(secret)
    if err != nil {
        return nil, err
    }
    
    secretBase32 := base32.StdEncoding.EncodeToString(secret)
    
    // Generate QR code URL
    qrURL := fmt.Sprintf(
        "otpauth://totp/%s:%s?secret=%s&issuer=%s",
        m.issuer,
        userID,
        secretBase32,
        m.issuer,
    )
    
    // Store encrypted secret
    encryptedSecret, err := encryptWithHSM(secret)
    if err != nil {
        return nil, err
    }
    
    err = m.redis.Set(
        ctx,
        fmt.Sprintf("mfa:secret:%s", userID),
        encryptedSecret,
        0,
    ).Err()
    
    if err != nil {
        return nil, err
    }
    
    // Generate backup codes
    backupCodes := m.generateBackupCodes(8)
    
    return &MFAEnrollment{
        Secret:      secretBase32,
        QRCode:      qrURL,
        BackupCodes: backupCodes,
    }, nil
}

// VerifyMFA verifies TOTP code
func (m *MFAService) VerifyMFA(userID, code string) error {
    // Get encrypted secret
    encryptedSecret, err := m.redis.Get(
        ctx,
        fmt.Sprintf("mfa:secret:%s", userID),
    ).Result()
    
    if err != nil {
        return ErrMFANotEnrolled
    }
    
    // Decrypt secret
    secret, err := decryptWithHSM([]byte(encryptedSecret))
    if err != nil {
        return err
    }
    
    // Verify TOTP
    valid := totp.Validate(code, base32.StdEncoding.EncodeToString(secret), time.Now())
    
    if !valid {
        // Check backup codes
        if m.verifyBackupCode(userID, code) {
            return nil
        }
        return ErrInvalidMFACode
    }
    
    // Rate limit successful attempts to prevent replay
    key := fmt.Sprintf("mfa:used:%s:%s", userID, code)
    exists, _ := m.redis.Exists(ctx, key).Result()
    
    if exists > 0 {
        return ErrMFACodeReused
    }
    
    // Mark code as used (30 second window)
    m.redis.Set(ctx, key, "1", 30*time.Second)
    
    return nil
}

// WebAuthn implementation
type WebAuthnService struct {
    webauthn *webauthn.WebAuthn
    store    CredentialStore
}

// BeginRegistration starts WebAuthn registration
func (w *WebAuthnService) BeginRegistration(user User) (*protocol.CredentialCreation, error) {
    // Create WebAuthn user
    webauthnUser := &WebAuthnUser{
        ID:          []byte(user.ID),
        Name:        user.Email,
        DisplayName: user.Name,
    }
    
    // Generate registration options
    options, sessionData, err := w.webauthn.BeginRegistration(
        webauthnUser,
        webauthn.WithAuthenticatorSelection(protocol.AuthenticatorSelection{
            AuthenticatorAttachment: protocol.Platform,
            RequireResidentKey:      protocol.ResidentKeyRequired(),
            UserVerification:        protocol.VerificationRequired,
        }),
        webauthn.WithAttestation(protocol.PreferDirectAttestation),
    )
    
    if err != nil {
        return nil, err
    }
    
    // Store session data
    err = w.storeSession(user.ID, sessionData)
    if err != nil {
        return nil, err
    }
    
    return options, nil
}

// OAuth 2.0 + PKCE implementation
type OAuth2Service struct {
    providers map[string]OAuth2Provider
}

func (o *OAuth2Service) GeneratePKCE() (*PKCEChallenge, error) {
    // Generate code verifier
    verifier := make([]byte, 32)
    _, err := rand.Read(verifier)
    if err != nil {
        return nil, err
    }
    
    verifierStr := base64.RawURLEncoding.EncodeToString(verifier)
    
    // Generate code challenge
    h := sha256.Sum256([]byte(verifierStr))
    challenge := base64.RawURLEncoding.EncodeToString(h[:])
    
    return &PKCEChallenge{
        Verifier:  verifierStr,
        Challenge: challenge,
        Method:    "S256",
    }, nil
}
                            </code>
                        </div>
                    </div>

                    <!-- Authorization -->
                    <div class="security-control">
                        <div class="control-header">
                            <div class="control-icon">
                                <i class="ti ti-user-check"></i>
                            </div>
                            <h3 class="control-title">Role-Based Access Control (RBAC)</h3>
                            <div class="control-effectiveness">
                                <div class="effectiveness-bar">
                                    <div class="effectiveness-fill" style="width: 90%"></div>
                                </div>
                                <span>90% Effective</span>
                            </div>
                        </div>
                        
                        <p>Fine-grained authorization with policy engine:</p>
                        
                        <div class="code-playground">
                            <code class="language-yaml">
# RBAC Configuration
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: storage-service-reader
  namespace: neo-prod
rules:
- apiGroups: [""]
  resources: ["services", "endpoints"]
  verbs: ["get", "list", "watch"]
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list"]
  resourceNames: ["storage-config"]
  
---
# ClusterRole for cross-namespace access
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: neo-service-operator
rules:
- apiGroups: ["apps"]
  resources: ["deployments", "statefulsets"]
  verbs: ["get", "list", "watch", "update", "patch"]
- apiGroups: [""]
  resources: ["services", "endpoints", "pods"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["autoscaling"]
  resources: ["horizontalpodautoscalers"]
  verbs: ["get", "list", "watch", "update", "patch"]
  
---
# OPA Policy for fine-grained authorization
package neo.authz

default allow = false

# Admin can do anything
allow {
    input.user.role == "admin"
}

# Service accounts can access their own namespace
allow {
    input.user.type == "service_account"
    input.action == "read"
    input.resource.namespace == input.user.namespace
}

# Users can only access their own data
allow {
    input.user.type == "user"
    input.action in ["read", "write"]
    input.resource.owner == input.user.id
}

# Specific service permissions
allow {
    input.user.service == "storage-service"
    input.action in ["read", "write"]
    input.resource.type == "storage_item"
}

# Rate limiting by role
rate_limit[msg] {
    input.user.role == "free"
    input.request_count > 100
    msg := "Free tier limited to 100 requests per hour"
}

rate_limit[msg] {
    input.user.role == "premium"
    input.request_count > 10000
    msg := "Premium tier limited to 10,000 requests per hour"
}
                            </code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Encryption Section -->
            <section id="encryption" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Encryption Standards</h2>
                    <div class="section-meta">
                        <span class="section-badge">Cryptography</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="security-control">
                        <div class="control-header">
                            <div class="control-icon">
                                <i class="ti ti-lock"></i>
                            </div>
                            <h3 class="control-title">Encryption Implementation</h3>
                            <div class="control-effectiveness">
                                <div class="effectiveness-bar">
                                    <div class="effectiveness-fill" style="width: 100%"></div>
                                </div>
                                <span>100% Coverage</span>
                            </div>
                        </div>
                        
                        <p>Enterprise-grade encryption for all data states:</p>
                        
                        <div class="code-playground">
                            <code class="language-go">
// Encryption service with HSM integration
package crypto

import (
    "crypto/aes"
    "crypto/cipher"
    "crypto/rand"
    "crypto/sha256"
    "encoding/base64"
    "fmt"
    
    "github.com/miekg/pkcs11"
)

type EncryptionService struct {
    hsm        *HSMClient
    keyCache   *KeyCache
    rotationInterval time.Duration
}

// EncryptData encrypts data using AES-256-GCM
func (e *EncryptionService) EncryptData(plaintext []byte, context string) (*EncryptedData, error) {
    // Get or generate data encryption key (DEK)
    dek, err := e.generateDEK()
    if err != nil {
        return nil, fmt.Errorf("failed to generate DEK: %w", err)
    }
    
    // Encrypt data with DEK
    block, err := aes.NewCipher(dek.Key)
    if err != nil {
        return nil, err
    }
    
    aesGCM, err := cipher.NewGCM(block)
    if err != nil {
        return nil, err
    }
    
    // Generate nonce
    nonce := make([]byte, aesGCM.NonceSize())
    if _, err := rand.Read(nonce); err != nil {
        return nil, err
    }
    
    // Encrypt with associated data
    additionalData := []byte(context)
    ciphertext := aesGCM.Seal(nil, nonce, plaintext, additionalData)
    
    // Wrap DEK with KEK from HSM
    wrappedDEK, err := e.hsm.WrapKey(dek.Key, dek.KeyID)
    if err != nil {
        return nil, fmt.Errorf("failed to wrap DEK: %w", err)
    }
    
    return &EncryptedData{
        Ciphertext:     ciphertext,
        Nonce:          nonce,
        WrappedDEK:     wrappedDEK,
        KeyID:          dek.KeyID,
        Algorithm:      "AES-256-GCM",
        AdditionalData: additionalData,
    }, nil
}

// Key rotation implementation
func (e *EncryptionService) RotateKeys() error {
    // Get current key version
    currentVersion, err := e.hsm.GetCurrentKeyVersion()
    if err != nil {
        return err
    }
    
    // Generate new key in HSM
    newKeyID, err := e.hsm.GenerateKey(&KeyGenParams{
        Algorithm: "AES-256",
        Purpose:   "ENCRYPT_DECRYPT",
        Exportable: false,
    })
    
    if err != nil {
        return err
    }
    
    // Re-encrypt all active DEKs
    activeDEKs, err := e.keyCache.GetActiveDEKs()
    if err != nil {
        return err
    }
    
    for _, dek := range activeDEKs {
        // Unwrap with old KEK
        plainDEK, err := e.hsm.UnwrapKey(dek.WrappedKey, currentVersion)
        if err != nil {
            continue // Log and continue
        }
        
        // Wrap with new KEK
        newWrappedDEK, err := e.hsm.WrapKey(plainDEK, newKeyID)
        if err != nil {
            continue // Log and continue
        }
        
        // Update cache
        dek.WrappedKey = newWrappedDEK
        dek.KeyVersion = newKeyID
        e.keyCache.Update(dek)
    }
    
    // Mark new key as active
    e.hsm.SetActiveKey(newKeyID)
    
    return nil
}

// Field-level encryption for sensitive data
type FieldEncryption struct {
    crypto EncryptionService
}

func (f *FieldEncryption) EncryptStruct(v interface{}) error {
    val := reflect.ValueOf(v).Elem()
    typ := val.Type()
    
    for i := 0; i < val.NumField(); i++ {
        field := typ.Field(i)
        tag := field.Tag.Get("encrypt")
        
        if tag == "true" {
            fieldVal := val.Field(i)
            if fieldVal.Kind() == reflect.String {
                plaintext := fieldVal.String()
                
                encrypted, err := f.crypto.EncryptData(
                    []byte(plaintext),
                    fmt.Sprintf("%s.%s", typ.Name(), field.Name),
                )
                
                if err != nil {
                    return err
                }
                
                // Store encrypted value
                fieldVal.SetString(base64.StdEncoding.EncodeToString(encrypted.Ciphertext))
            }
        }
    }
    
    return nil
}

// Database encryption with transparent encryption
type TransparentEncryption struct {
    enabled bool
    keyID   string
}

func (t *TransparentEncryption) BeforeCreate(tx *gorm.DB) error {
    if !t.enabled {
        return nil
    }
    
    // Encrypt sensitive fields before insertion
    tx.Statement.SetColumn("encryption_key_id", t.keyID)
    
    return nil
}

// Example usage with GORM
type User struct {
    ID       string `gorm:"primaryKey"`
    Email    string `gorm:"uniqueIndex" encrypt:"true"`
    Name     string
    Password string `encrypt:"true"` // Encrypted + hashed
    SSN      string `encrypt:"true" pii:"true"`
}
                            </code>
                        </div>
                        
                        <h4>Encryption Standards</h4>
                        <ul>
                            <li><strong>Data at Rest:</strong> AES-256-GCM with HSM-protected keys</li>
                            <li><strong>Data in Transit:</strong> TLS 1.3 with forward secrecy</li>
                            <li><strong>Key Management:</strong> FIPS 140-2 Level 3 HSM</li>
                            <li><strong>Key Rotation:</strong> Automatic 90-day rotation</li>
                            <li><strong>Quantum-Resistant:</strong> Post-quantum algorithms ready</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Audit Logging Section -->
            <section id="audit-logging" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Audit Logging & Monitoring</h2>
                    <div class="section-meta">
                        <span class="section-badge">Compliance</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="security-control">
                        <div class="control-header">
                            <div class="control-icon">
                                <i class="ti ti-file-text"></i>
                            </div>
                            <h3 class="control-title">Comprehensive Audit Trail</h3>
                        </div>
                        
                        <p>Immutable audit logging for all security-relevant events:</p>
                        
                        <div class="audit-log-example">
2025-01-30T10:23:45.123Z [AUDIT] event=authentication.success user_id=usr_123abc ip=192.168.1.100 method=mfa service=identity-service
2025-01-30T10:23:46.234Z [AUDIT] event=authorization.check user_id=usr_123abc resource=storage.write.bucket-123 result=allow service=storage-service
2025-01-30T10:23:47.345Z [AUDIT] event=data.access user_id=usr_123abc action=read resource=item_456def classification=confidential service=storage-service
2025-01-30T10:23:48.456Z [AUDIT] event=key.rotation key_id=kek_789ghi version=v2 service=crypto-service
2025-01-30T10:23:49.567Z [AUDIT] event=admin.action user_id=adm_001 action=user.permission.grant target_user=usr_456def permission=storage.admin
                        </div>
                        
                        <div class="code-playground">
                            <code class="language-go">
// Audit logging implementation
package audit

import (
    "context"
    "crypto/sha256"
    "encoding/hex"
    "fmt"
    "time"
)

type AuditLogger struct {
    blockchain BlockchainLogger
    storage    StorageBackend
    signer     CryptoSigner
}

type AuditEvent struct {
    ID            string                 `json:"id"`
    Timestamp     time.Time              `json:"timestamp"`
    EventType     string                 `json:"event_type"`
    Actor         Actor                  `json:"actor"`
    Resource      Resource               `json:"resource"`
    Action        string                 `json:"action"`
    Result        string                 `json:"result"`
    Details       map[string]interface{} `json:"details"`
    Hash          string                 `json:"hash"`
    PreviousHash  string                 `json:"previous_hash"`
    Signature     string                 `json:"signature"`
}

// LogEvent logs security event with integrity protection
func (a *AuditLogger) LogEvent(ctx context.Context, event AuditEvent) error {
    // Set timestamp and ID
    event.Timestamp = time.Now().UTC()
    event.ID = generateEventID()
    
    // Get previous hash for chain integrity
    previousHash, err := a.storage.GetLatestHash()
    if err != nil && err != ErrNoEvents {
        return err
    }
    event.PreviousHash = previousHash
    
    // Calculate event hash
    event.Hash = a.calculateHash(event)
    
    // Sign event
    signature, err := a.signer.Sign([]byte(event.Hash))
    if err != nil {
        return err
    }
    event.Signature = hex.EncodeToString(signature)
    
    // Store in multiple backends for redundancy
    
    // 1. Local storage (fast access)
    if err := a.storage.Store(event); err != nil {
        // Log but don't fail
        log.Errorf("Failed to store audit event locally: %v", err)
    }
    
    // 2. Blockchain (immutable record)
    go func() {
        if err := a.blockchain.LogEvent(event); err != nil {
            log.Errorf("Failed to log to blockchain: %v", err)
        }
    }()
    
    // 3. SIEM integration
    go func() {
        if err := a.forwardToSIEM(event); err != nil {
            log.Errorf("Failed to forward to SIEM: %v", err)
        }
    }()
    
    return nil
}

// Security event correlation
type EventCorrelator struct {
    window   time.Duration
    patterns []CorrelationPattern
}

func (ec *EventCorrelator) AnalyzeEvents(events []AuditEvent) []SecurityAlert {
    alerts := []SecurityAlert{}
    
    for _, pattern := range ec.patterns {
        if matches := pattern.Match(events); len(matches) > 0 {
            alert := SecurityAlert{
                ID:       generateAlertID(),
                Severity: pattern.Severity,
                Type:     pattern.AlertType,
                Message:  pattern.Description,
                Events:   matches,
                Time:     time.Now(),
            }
            alerts = append(alerts, alert)
        }
    }
    
    return alerts
}

// Example correlation patterns
var correlationPatterns = []CorrelationPattern{
    {
        Name: "Brute Force Attack",
        AlertType: "authentication.brute_force",
        Severity: "HIGH",
        Description: "Multiple failed authentication attempts detected",
        Conditions: []Condition{
            {Field: "event_type", Operator: "equals", Value: "authentication.failed"},
            {Field: "count", Operator: "greater_than", Value: 5},
            {Field: "time_window", Operator: "within", Value: "5m"},
            {Field: "actor.ip", Operator: "same", Value: true},
        },
    },
    {
        Name: "Privilege Escalation",
        AlertType: "authorization.escalation",
        Severity: "CRITICAL",
        Description: "Unusual privilege escalation detected",
        Conditions: []Condition{
            {Field: "event_type", Operator: "equals", Value: "authorization.grant"},
            {Field: "resource.sensitivity", Operator: "equals", Value: "high"},
            {Field: "actor.role", Operator: "not_equals", Value: "admin"},
        },
    },
    {
        Name: "Data Exfiltration",
        AlertType: "data.exfiltration",
        Severity: "CRITICAL",
        Description: "Potential data exfiltration detected",
        Conditions: []Condition{
            {Field: "event_type", Operator: "equals", Value: "data.export"},
            {Field: "size_bytes", Operator: "greater_than", Value: 1073741824}, // 1GB
            {Field: "time_window", Operator: "within", Value: "10m"},
        },
    },
}

// Compliance reporting
func (a *AuditLogger) GenerateComplianceReport(startTime, endTime time.Time) (*ComplianceReport, error) {
    events, err := a.storage.GetEventsBetween(startTime, endTime)
    if err != nil {
        return nil, err
    }
    
    report := &ComplianceReport{
        Period:    fmt.Sprintf("%s to %s", startTime.Format(time.RFC3339), endTime.Format(time.RFC3339)),
        Generated: time.Now(),
        Summary: ComplianceSummary{
            TotalEvents:           len(events),
            SecurityEvents:        countSecurityEvents(events),
            AccessControlEvents:   countAccessControlEvents(events),
            DataAccessEvents:      countDataAccessEvents(events),
            AdministrativeEvents:  countAdminEvents(events),
        },
    }
    
    // Verify audit trail integrity
    integrityCheck := a.verifyAuditTrailIntegrity(events)
    report.IntegrityStatus = integrityCheck
    
    return report, nil
}
                            </code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Compliance Section -->
            <section id="compliance" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Compliance & Certifications</h2>
                    <div class="section-meta">
                        <span class="section-badge">Regulatory</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="compliance-overview">
                        <h3>Compliance Framework Coverage</h3>
                        
                        <div class="compliance-matrix">
                            <table class="compliance-table">
                                <thead>
                                    <tr>
                                        <th>Framework</th>
                                        <th>Status</th>
                                        <th>Last Audit</th>
                                        <th>Next Audit</th>
                                        <th>Coverage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>SOC 2 Type II</strong></td>
                                        <td><span class="compliance-status status-compliant">✓ Compliant</span></td>
                                        <td>Dec 2024</td>
                                        <td>Jun 2025</td>
                                        <td>Security, Availability, Processing Integrity</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ISO 27001</strong></td>
                                        <td><span class="compliance-status status-compliant">✓ Certified</span></td>
                                        <td>Oct 2024</td>
                                        <td>Oct 2025</td>
                                        <td>Information Security Management</td>
                                    </tr>
                                    <tr>
                                        <td><strong>GDPR</strong></td>
                                        <td><span class="compliance-status status-compliant">✓ Compliant</span></td>
                                        <td>Jan 2025</td>
                                        <td>Jul 2025</td>
                                        <td>Data Privacy & Protection</td>
                                    </tr>
                                    <tr>
                                        <td><strong>HIPAA</strong></td>
                                        <td><span class="compliance-status status-partial">⚠ Partial</span></td>
                                        <td>Nov 2024</td>
                                        <td>May 2025</td>
                                        <td>Technical Safeguards Only</td>
                                    </tr>
                                    <tr>
                                        <td><strong>PCI DSS</strong></td>
                                        <td><span class="compliance-status status-planned">○ Planned</span></td>
                                        <td>-</td>
                                        <td>Q3 2025</td>
                                        <td>Level 1 Service Provider</td>
                                    </tr>
                                    <tr>
                                        <td><strong>FedRAMP</strong></td>
                                        <td><span class="compliance-status status-planned">○ Planned</span></td>
                                        <td>-</td>
                                        <td>Q4 2025</td>
                                        <td>Moderate Impact Level</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Incident Response Section -->
            <section id="incident-response" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Incident Response</h2>
                    <div class="section-meta">
                        <span class="section-badge">Emergency Procedures</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="incident-response">
                        <div class="threat-header">
                            <i class="ti ti-urgent threat-icon"></i>
                            <h3 class="threat-title">Incident Response Plan</h3>
                        </div>
                        
                        <p>Structured approach to security incident handling:</p>
                        
                        <div class="response-phase">
                            <div class="phase-number">1</div>
                            <div class="phase-content">
                                <div class="phase-title">Detection & Analysis</div>
                                <div class="phase-duration">0-15 minutes</div>
                            </div>
                        </div>
                        
                        <div class="response-phase">
                            <div class="phase-number">2</div>
                            <div class="phase-content">
                                <div class="phase-title">Containment & Isolation</div>
                                <div class="phase-duration">15-30 minutes</div>
                            </div>
                        </div>
                        
                        <div class="response-phase">
                            <div class="phase-number">3</div>
                            <div class="phase-content">
                                <div class="phase-title">Eradication & Recovery</div>
                                <div class="phase-duration">30 minutes - 4 hours</div>
                            </div>
                        </div>
                        
                        <div class="response-phase">
                            <div class="phase-number">4</div>
                            <div class="phase-content">
                                <div class="phase-title">Post-Incident Analysis</div>
                                <div class="phase-duration">24-48 hours</div>
                            </div>
                        </div>
                        
                        <div class="code-playground">
                            <code class="language-bash">
#!/bin/bash
# incident-response.sh - Automated incident response

# Phase 1: Detection
detect_incident() {
    echo "[$(date)] Phase 1: Detecting incident..."
    
    # Check system metrics
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    MEMORY_USAGE=$(free | grep Mem | awk '{print ($3/$2) * 100.0}')
    DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | cut -d'%' -f1)
    
    # Check for anomalies
    if (( $(echo "$CPU_USAGE > 90" | bc -l) )); then
        trigger_incident "High CPU usage detected: ${CPU_USAGE}%"
    fi
    
    # Check for security events
    FAILED_LOGINS=$(journalctl -u sshd --since "10 minutes ago" | grep -c "Failed password")
    if [ $FAILED_LOGINS -gt 10 ]; then
        trigger_incident "Brute force attack detected: $FAILED_LOGINS failed logins"
    fi
}

# Phase 2: Containment
contain_incident() {
    local incident_type="$1"
    echo "[$(date)] Phase 2: Containing incident: $incident_type"
    
    case $incident_type in
        "brute_force")
            # Block suspicious IPs
            fail2ban-client set sshd banip $ATTACKER_IP
            
            # Enable stricter firewall rules
            ufw default deny incoming
            ufw allow from 10.0.0.0/8 to any port 22
            ;;
            
        "data_breach")
            # Isolate affected services
            kubectl cordon $AFFECTED_NODE
            kubectl drain $AFFECTED_NODE --ignore-daemonsets
            
            # Revoke compromised credentials
            vault lease revoke -prefix auth/
            ;;
            
        "ddos")
            # Enable DDoS protection
            cloudflare-api enable-under-attack-mode
            
            # Scale up resources
            kubectl scale deployment api-gateway --replicas=20
            ;;
    esac
    
    # Capture forensic data
    capture_forensics
}

# Phase 3: Eradication
eradicate_threat() {
    echo "[$(date)] Phase 3: Eradicating threat..."
    
    # Patch vulnerabilities
    apt-get update && apt-get upgrade -y
    
    # Rotate all credentials
    ./scripts/rotate-all-credentials.sh
    
    # Scan for malware
    clamscan -r --bell -i /
    
    # Verify system integrity
    aide --check
}

# Phase 4: Recovery
recover_services() {
    echo "[$(date)] Phase 4: Recovering services..."
    
    # Restore from clean backup
    kubectl apply -f ./backups/last-known-good/
    
    # Verify service health
    for service in ${SERVICES[@]}; do
        kubectl wait --for=condition=ready pod -l app=$service --timeout=300s
    done
    
    # Run smoke tests
    ./scripts/smoke-tests.sh
}

# Forensics collection
capture_forensics() {
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local forensics_dir="/forensics/$timestamp"
    
    mkdir -p $forensics_dir
    
    # System state
    ps auxww > $forensics_dir/processes.txt
    netstat -tulpn > $forensics_dir/network.txt
    lsof -i > $forensics_dir/open_files.txt
    
    # Memory dump (if available)
    if command -v volatility &> /dev/null; then
        volatility -f /proc/kcore --profile=LinuxUbuntu20x64 linux_pslist > $forensics_dir/memory_analysis.txt
    fi
    
    # Container logs
    kubectl logs --all-namespaces --since=1h > $forensics_dir/k8s_logs.txt
    
    # Audit logs
    ausearch -ts recent > $forensics_dir/audit_logs.txt
    
    # Create encrypted archive
    tar -czf - $forensics_dir | gpg --encrypt -r security-team@company.com > $forensics_dir.tar.gz.gpg
}

# Main incident response flow
main() {
    INCIDENT_ID=$(uuidgen)
    
    echo "[$(date)] Incident Response Started - ID: $INCIDENT_ID"
    
    # Create incident ticket
    create_incident_ticket $INCIDENT_ID
    
    # Execute response phases
    detect_incident
    contain_incident $INCIDENT_TYPE
    eradicate_threat
    recover_services
    
    # Post-incident
    generate_incident_report $INCIDENT_ID
    schedule_postmortem $INCIDENT_ID
    
    echo "[$(date)] Incident Response Completed - ID: $INCIDENT_ID"
}

main "$@"
                            </code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Security Hardening Checklist -->
            <section id="hardening-checklist" class="docs-section">
                <div class="section-header">
                    <h2 class="section-title">Security Hardening Checklist</h2>
                    <div class="section-meta">
                        <span class="section-badge">Production Ready</span>
                    </div>
                </div>

                <div class="section-content">
                    <div class="security-checklist">
                        <h3>Complete Security Hardening Checklist</h3>
                        <p>Ensure all items are completed before production deployment:</p>
                        
                        <div class="checklist-category">
                            <h4 class="checklist-category-title">🔐 Authentication & Access Control</h4>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Multi-factor authentication enabled for all administrative accounts
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    API keys rotated every 90 days with automated rotation
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Role-based access control (RBAC) implemented with least privilege
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Service accounts use separate credentials with minimal permissions
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Password policy enforces complexity and regular changes
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-category">
                            <h4 class="checklist-category-title">🛡️ Network Security</h4>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Network segmentation implemented with micro-segmentation
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Web Application Firewall (WAF) enabled with custom rules
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    DDoS protection configured with rate limiting
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    All traffic encrypted with TLS 1.3 minimum
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Mutual TLS (mTLS) enabled for service-to-service communication
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-category">
                            <h4 class="checklist-category-title">💾 Data Protection</h4>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Encryption at rest enabled for all data stores
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Key management using HSM or KMS
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Regular automated backups with encryption
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Data classification and handling policies implemented
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    PII data masked in non-production environments
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-category">
                            <h4 class="checklist-category-title">📊 Monitoring & Logging</h4>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Centralized logging with tamper protection
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Security monitoring with real-time alerts
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Audit logs retained for compliance period
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Intrusion detection system (IDS) deployed
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    File integrity monitoring (FIM) enabled
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-category">
                            <h4 class="checklist-category-title">🚨 Incident Response</h4>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Incident response plan documented and tested
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Security team contact information updated
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Forensic tools installed and ready
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Regular incident response drills conducted
                                </div>
                            </div>
                            <div class="checklist-item">
                                <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                                <div class="checklist-content">
                                    Post-incident review process established
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="../src/scripts/navigation.js"></script>
    <script src="../src/scripts/docs-search.js"></script>
    <script src="../src/scripts/code-playground.js"></script>
    
    <!-- Security guide specific JavaScript -->
    <script>
        // Checklist functionality
        function toggleCheck(checkbox) {
            checkbox.classList.toggle('checked');
            
            // Save state to localStorage
            const checklistState = {};
            document.querySelectorAll('.checklist-checkbox').forEach((cb, index) => {
                checklistState[`item-${index}`] = cb.classList.contains('checked');
            });
            localStorage.setItem('security-checklist', JSON.stringify(checklistState));
            
            // Update progress
            updateChecklistProgress();
        }
        
        // Load checklist state
        document.addEventListener('DOMContentLoaded', () => {
            const savedState = localStorage.getItem('security-checklist');
            if (savedState) {
                const checklistState = JSON.parse(savedState);
                document.querySelectorAll('.checklist-checkbox').forEach((cb, index) => {
                    if (checklistState[`item-${index}`]) {
                        cb.classList.add('checked');
                    }
                });
            }
            
            updateChecklistProgress();
        });
        
        // Update checklist progress
        function updateChecklistProgress() {
            const total = document.querySelectorAll('.checklist-checkbox').length;
            const checked = document.querySelectorAll('.checklist-checkbox.checked').length;
            const progress = (checked / total) * 100;
            
            // Update progress indicator if exists
            const progressElement = document.getElementById('checklist-progress');
            if (progressElement) {
                progressElement.style.width = `${progress}%`;
                progressElement.textContent = `${Math.round(progress)}%`;
            }
        }
        
        // Copy button functionality for code blocks
        document.querySelectorAll('.code-playground code').forEach(block => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.innerHTML = '<i class="ti ti-copy"></i>';
            button.onclick = () => {
                navigator.clipboard.writeText(block.textContent);
                button.innerHTML = '<i class="ti ti-check"></i>';
                setTimeout(() => {
                    button.innerHTML = '<i class="ti ti-copy"></i>';
                }, 2000);
            };
            block.parentElement.appendChild(button);
        });
    </script>
</body>
</html>